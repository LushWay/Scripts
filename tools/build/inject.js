import { writeFile } from 'fs/promises'
import { LeafyLogger } from 'leafy-utils'
import path from 'path'

/**
 * @param {string} modifier
 * @param {string} code
 */
export function injectCode(modifier, code) {
  return `// prettier-ignore
/* eslint-disable */
// This file is autogenerated by ${modifier}.
// Do not modify manually.
    
${code}
`
}

const logger = new LeafyLogger({ prefix: 'assets' })

/**
 * @param {string} asset
 * @param {string} caller
 * @param {string | (() => Promise<string> | string)} code
 */
export async function injectAsset(asset, caller, code, base = '.') {
  try {
    if (typeof code === 'function') code = await code()

    await writeFile(path.join(base, 'src', 'lib', 'assets', asset), injectCode(caller, code))
  } catch (e) {
    logger.error(`Unable to write asset ${asset}:`, e)
  }
}
